---
import { fetchPlaylistVideos } from "@/lib/youtube";

import VideoList from "@/components/pages/video-and-media/VideoList.astro";

import background_svg_blob from "@/assets/about/about-us/background-svg-blob.svg";
import { languages, ui } from "@/i18n/ui";
import { getLangFromUrl } from "@/i18n/utils";
import BlogLayout from "@/layouts/BlogLayout.astro";

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

const lang = getLangFromUrl(Astro.url);
const translations = ui[lang];

const videos = await fetchPlaylistVideos(
  import.meta.env.PUBLIC_YOUTUBE_API_KEY,
  import.meta.env.PUBLIC_PLAYLIST_ID,
);
---

<BlogLayout
  title="វីដេអូ និង ការផ្សព្វផ្សាយ - Videos & Media"
  author="DSDP Cambodia"
  description="Explore our collection of videos and media showcasing our programs, events, and impact stories."
>
  <!-- Background decorations -->
  <section class="relative left-1/2 -translate-x-1/2 overflow-hidden">
    <div class="absolute inset-0 -z-10 pointer-events-none">
      <img
        src={background_svg_blob.src}
        alt="bottom background"
        class="absolute bottom-[10%] left-[50%] w-full max-w-full h-auto rotate-[270deg] -scale-x-[1]"
      />
    </div>
    <!-- Video List Section  -->
    <VideoList videos={videos} lang={lang} translations={translations} />
  </section>
</BlogLayout>
